<!-- Markup -->
<h2><code>st.</code> command generator</h2>
<p>Select a widget and hit "generate" below to get its code!</p>
<button id="generate">Generate!</button>
<div class="message" style="display: none;"></div>
<ul class="widget-information" style="display: none;"></div>

<!-- Interactivity -->
<script>
  // Variables
  const notification = document.querySelector('.message');
  const information = document.querySelector('.widget-information');

  // Onclick handler to get the code
  document.getElementById('generate').onclick = () => {
    parent.postMessage({ pluginMessage: { type: 'clean-old-data' } }, '*');
    parent.postMessage({ pluginMessage: { type: 'identify-widget' } }, '*');
  }

  // Check the data we are getting from the plugin
  onmessage = (event) => {
    switch(event.data.pluginMessage.type) {
      case 'success':
        // Show success message
        notification.style.display = 'block';
        notification.classList.add('success');
        notification.innerText = event.data.pluginMessage.message;
        
        // Add the markup for the component
        information.style.display = 'block';
        const container = document.createElement('li');
        container.innerHTML = `
          <hr />
          <h3>You selected: <span>${event.data.pluginMessage.component.name}</span></h3>
          <p class="description">${event.data.pluginMessage.component.description}</p>
          <code>${event.data.pluginMessage.component.markup}</code>
          <p class="documentation">
            Need more help? Check
            <a
              href="${event.data.pluginMessage.component.link}"
              target="_blank"
              rel="noopener noreferrer"
            >
              Our docs for this component
            </a>.
          </p>
        `;
        information.appendChild(container);

        break;

      // Show error message
      case 'error':
        notification.style.display = 'block';
        notification.classList.add('error');
        notification.innerText = event.data.pluginMessage.message;
        break;
      
        // Cleanup message
      case 'cleanup':
        notification.style.display = 'none';
        information.innerHTML = '';
        information.style.display = 'none';
        break;
    }
  }
</script>
